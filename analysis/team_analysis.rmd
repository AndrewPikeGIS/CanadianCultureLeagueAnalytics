---
title: "team_analysis"
author: "Andrew Pike"
date: "25/09/2022"
output: html_document
---
```{r load_package, echo = FALSE, warning = FALSE, message = FALSE}
pkgload::load_all()
```


## Load Data 

```{r read_tables, include=FALSE}
team_logs <- read_team_logs()

manager_table <- read_manager_table()

standings_table <- read_standings_table()
```

## Table Joins
```{r join_tables}
team_log_w_manager <- join_manager_table(team_logs, manager_table)

full_table <- join_standings_table(team_log_w_manager, standings_table) %>%
    normalize_gp()
```

## Games Played

```{r games played plot, echo=FALSE}
full_table %>%
    dplyr::filter(
        Name == "Total"
    ) %>%
    dplyr::group_by(
        year
    ) %>%
    plotly::plot_ly(
        x = ~year,
        y = ~GP_norm,
        type = "bar",
        color = ~Manager,
        text = ~team_name
    )
```


```{r, echo = FALSE, warning = FALSE, message = FALSE}
full_table %>%
    dplyr::filter(
        Name == "Total"
    ) %>%
    plotly::plot_ly(
        x = ~final_rank,
        y = ~GP_norm,
        type = "scatter",
        color = ~Manager,
        text = ~team_name
    )
```

```{r, echo = FALSE, warning = FALSE, message = FALSE}
numeric_table <- full_table %>%
    dplyr::filter(Name == "Total") %>%
    dplyr::select_if(is.numeric) %>%
    dplyr::select(
        -c(
            "Waiver",
            "Pts",
            "Pct",
            "year"
        )
    )

cor_numeric <- cor(numeric_table)

corrplot::corrplot.mixed(cor_numeric, upper = "ellipse", lower = "number", tl.pos = "lt")
```

```{r build_regression, echo = FALSE, warning = FALSE, message = FALSE}
totals_table <- full_table %>%
    dplyr::filter(
        Name == "Total"
    )

skim_table <- skimr::skim(totals_table)

reactable::reactable(skim_table)
```